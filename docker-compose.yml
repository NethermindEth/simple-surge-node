services:
# Deployer
  surge-l1-deployer:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-protocol:main-pacaya-v1.6.1-proposer-wrapper
    container_name: surge-l1-deployer
    pull_policy: always
    volumes:
      - ./deployer:/deployer
      - ./deployment:/deployment
    entrypoint:
      - /bin/sh
      - -c
      - /deployer/deploy-surge-l1.sh
    env_file:
      - .env
    environment:
      USE_TIMELOCKED_OWNER: ${USE_TIMELOCKED_OWNER:-false}
      SHOULD_SETUP_VERIFIERS: ${SHOULD_SETUP_VERIFIERS:-false}
      BROADCAST: ${BROADCAST:-false}
      MR_ENCLAVE: ${MR_ENCLAVE:-3ec57ed7974834005b8df5d80e0edfc69542580a0a305f80fd81199c181ac7cc}
      MR_SIGNER: ${MR_SIGNER:-ca0583a715534a8c981b914589a7f0dc5d60959d9ae79fb5353299a4231673d5}
      V3_QUOTE_BYTES: ${V3_QUOTE_BYTES:-"03000200000000000b001000939a7233f79c4ca9940a0db3957f0607f120255a6d29b13c5a97f7e2bded18330000000015150b07ff800e0000000000000000000000000000000000000000000000000000000000000000000000000000000000050000000000000007000000000000003ec57ed7974834005b8df5d80e0edfc69542580a0a305f80fd81199c181ac7cc0000000000000000000000000000000000000000000000000000000000000000ca0583a715534a8c981b914589a7f0dc5d60959d9ae79fb5353299a4231673d500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c6175b0b519fd73bb6b5cc5bea4895e56104780a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044100000c4ee9d4e34a17b2099f9417888390c6d53ea749ec76df01210e2979c446b6324291a77892f08ca50e080c9fb751320f6b33ce504a02ed36b27e6ee33bc51f51edcc70e02ad7240cdf217886140340832c403f921a77e5da4a8251bbc3c52f8b5d2ddb259b51858e1418cf7654e553f3c60d387a3a1854e00d30ad816ce302ff315150b07ff800e00000000000000000000000000000000000000000000000000000000000000000000000000000000001500000000000000070000000000000078fe8cfd01095a0f108aff5c40624b93612d6c28b73e1a8d28179c9ddf0e068600000000000000000000000000000000000000000000000000000000000000008c4f5775d796503e96137f77c68a829a0056ac8ded70140b081b094490c57bff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096e0b3e7d61fda4ebbca044c165b7e31a488c325f1c438153df056329899709d0000000000000000000000000000000000000000000000000000000000000000fe095b7c9a52827a2fa19324360ba4821c8b5a6d7068cc85b32ac4e795b34e63e6c6bd722e1988819e67f7722c4f69698cc9cf4462c4850adbbb1a3c1ef206952000000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f0500dc0d00002d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949456a6a4343424453674177494241674956414d355778474753413543316738436664583042644d65736a4161434d416f4743437147534d343942414d430a4d484578497a416842674e5642414d4d476b6c756447567349464e48574342515130736755484a765932567a6332397949454e424d526f77474159445651514b0a4442464a626e526c6243424462334a7762334a6864476c76626a45554d424947413155454277774c553246756447456751327868636d4578437a414a42674e560a4241674d416b4e424d517377435159445651514745774a56557a4165467730794e5441324d546b774e6a41344e444a614677307a4d6a41324d546b774e6a41340a4e444a614d484178496a416742674e5642414d4d47556c756447567349464e4857434251513073675132567964476c6d61574e6864475578476a415942674e560a42416f4d45556c756447567349454e76636e4276636d4630615739754d5251774567594456515148444174545957353059534244624746795954454c4d416b470a413155454341774351304578437a414a42674e5642415954416c56544d466b77457759484b6f5a497a6a3043415159494b6f5a497a6a304441516344516741450a534e417632765034454d48536e364e7a77314d4a56467366484143625577647569365a45594156782b5163414335743474476f445876636d7239717766724e410a726933416c6f5657716e544e377639316e78574334364f434171677767674b6b4d42384741315564497751594d426141464e446f71747031312f6b75535265590a504873555a644456386c6c4e4d477747413155644877526c4d474d77596142666f463247573268306448427a4f693876595842704c6e527964584e305a57527a0a5a584a3261574e6c63793570626e526c6243356a62323076633264344c324e6c636e52705a6d6c6a5958527062323476646a517663474e7259334a7350324e680a5058427962324e6c63334e7663695a6c626d4e765a476c755a7a316b5a584977485159445652304f42425945464c713947373168774d6478372f696f462f6a520a66706531377032374d41344741315564447745422f775145417749477744414d42674e5648524d4241663845416a41414d4949423141594a4b6f5a496876684e0a415130424249494278544343416345774867594b4b6f5a496876684e41513042415151516e43434f70394f2b436972694e3366544a7167346e7a4343415751470a43697147534962345451454e41514977676746554d42414743797147534962345451454e41514942416745564d42414743797147534962345451454e415149430a416745564d42414743797147534962345451454e41514944416745434d42414743797147534962345451454e41514945416745454d42414743797147534962340a5451454e41514946416745424d42454743797147534962345451454e41514947416749416744415142677371686b69472b4530424451454342774942446a41510a42677371686b69472b45304244514543434149424144415142677371686b69472b45304244514543435149424144415142677371686b69472b453042445145430a436749424144415142677371686b69472b45304244514543437749424144415142677371686b69472b45304244514543444149424144415142677371686b69470a2b45304244514543445149424144415142677371686b69472b45304244514543446749424144415142677371686b69472b4530424451454344774942414441510a42677371686b69472b45304244514543454149424144415142677371686b69472b45304244514543455149424454416642677371686b69472b453042445145430a4567515146525543424147414467414141414141414141414144415142676f71686b69472b45304244514544424149414144415542676f71686b69472b4530420a44514545424159416b473756414141774477594b4b6f5a496876684e4151304242516f424144414b42676771686b6a4f5051514441674e4941444246416941620a597055715470513662672f4d697a376a4473517873706f515a6b4768584c5245564f704a303471734b774968414e594b355a53614c734a61756a4a44727331670a5238356e6f304863617341747a497964316b74476855596a0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949436d444343416a36674177494241674956414e446f71747031312f6b7553526559504873555a644456386c6c4e4d416f4743437147534d343942414d430a4d476778476a415942674e5642414d4d45556c756447567349464e48574342536232393049454e424d526f77474159445651514b4442464a626e526c624342440a62334a7762334a6864476c76626a45554d424947413155454277774c553246756447456751327868636d4578437a414a42674e564241674d416b4e424d5173770a435159445651514745774a56557a4165467730784f4441314d6a45784d4455774d5442614677307a4d7a41314d6a45784d4455774d5442614d484578497a41680a42674e5642414d4d476b6c756447567349464e48574342515130736755484a765932567a6332397949454e424d526f77474159445651514b4442464a626e526c0a6243424462334a7762334a6864476c76626a45554d424947413155454277774c553246756447456751327868636d4578437a414a42674e564241674d416b4e420a4d517377435159445651514745774a56557a425a4d424d4742797147534d34394167454743437147534d34394177454841304941424c39712b4e4d7032494f670a74646c31626b2f75575a352b5447516d38614369387a373866732b664b435133642b75447a586e56544154325a68444369667949754a77764e33774e427039690a484253534d4a4d4a72424f6a6762737767626777487759445652306a42426777466f4155496d554d316c71644e496e7a6737535655723951477a6b6e427177770a556759445652306642457377535442486f45576751345a426148523063484d364c79396a5a584a3061575a70593246305a584d7564484a316333526c5a484e6c0a636e5a705932567a4c6d6c75644756734c6d4e766253394a626e526c62464e4857464a76623352445153356b5a584977485159445652304f42425945464e446f0a71747031312f6b7553526559504873555a644456386c6c4e4d41344741315564447745422f77514541774942426a415342674e5648524d4241663845434441470a4151482f416745414d416f4743437147534d343942414d43413067414d4555434951434a6754627456714f795a316d336a716941584d365159613672357357530a34792f4737793875494a4778647749675271507642534b7a7a516167424c517135733541373070646f6961524a387a2f3075447a344e675639316b3d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949436a7a4343416a53674177494241674955496d554d316c71644e496e7a6737535655723951477a6b6e42717777436759494b6f5a497a6a3045417749770a614445614d4267474131554541777752535735305a5777675530645949464a766233516751304578476a415942674e5642416f4d45556c756447567349454e760a636e4276636d4630615739754d5251774567594456515148444174545957353059534244624746795954454c4d416b47413155454341774351304578437a414a0a42674e5642415954416c56544d423458445445344d4455794d5445774e4455784d466f58445451354d54497a4d54497a4e546b314f566f77614445614d4267470a4131554541777752535735305a5777675530645949464a766233516751304578476a415942674e5642416f4d45556c756447567349454e76636e4276636d46300a615739754d5251774567594456515148444174545957353059534244624746795954454c4d416b47413155454341774351304578437a414a42674e56424159540a416c56544d466b77457759484b6f5a497a6a3043415159494b6f5a497a6a3044415163445167414543366e45774d4449595a4f6a2f69505773437a61454b69370a314f694f534c52466857476a626e42564a66566e6b59347533496a6b4459594c304d784f346d717379596a6c42616c54565978465032734a424b357a6c4b4f420a757a43427544416642674e5648534d4547444157674251695a517a575770303069664f44744a5653763141624f5363477244425342674e5648523845537a424a0a4d45656752614244686b466f64485277637a6f764c324e6c636e52705a6d6c6a5958526c63793530636e567a6447566b63325679646d6c6a5a584d75615735300a5a577775593239744c306c756447567355306459556d397664454e424c6d526c636a416442674e564851344546675155496d554d316c71644e496e7a673753560a55723951477a6b6e4271777744675944565230504151482f42415144416745474d42494741315564457745422f7751494d4159424166384341514577436759490a4b6f5a497a6a3045417749445351417752674968414f572f35516b522b533943695344634e6f6f774c7550524c735747662f59693747535839344267775477670a41694541344a306c72486f4d732b586f356f2f7358364f39515778485241765a55474f6452513763767152586171493d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a00"}
      RISC0_AGGREGATION_IMAGE_ID: ${RISC0_AGGREGATION_IMAGE_ID:-0x00dfdb4cc33bb068dce12585b8ecfcc8c3ae194ffaf6d19e0ebfd3fc33145c7a}
      RISC0_BLOCK_PROVING_IMAGE_ID: ${RISC0_BLOCK_PROVING_IMAGE_ID:-0x002eb51e99132ea02f27349345fe7e98c6867beab29a2426d1e4f693e2857bcd}
      SP1_BLOCK_PROVING_PROGRAM_VKEY: ${SP1_BLOCK_PROVING_PROGRAM_VKEY:-7551aa7009644e503ffa7fce53f657264a3a1b45516afc5b026ff7e43c10d62a}
      SP1_AGGREGATION_PROGRAM_VKEY: ${SP1_AGGREGATION_PROGRAM_VKEY:-0x000795db478eeeb7bef37247eb93389ba2a4e6c1cbe59a49afc3bd6ac2ad27ba}
      FOUNDRY_PROFILE: layer1
    networks:
      - surge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    healthcheck:
      test: ["CMD-SHELL", "bash -c 'test -f /app/deployments/deploy_l1.json'"]
      interval: 2s
      timeout: 2s
      retries: 15
      start_period: 10s
    profiles:
      - l1-deployer

  proposer-wrapper-deployer:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-protocol:main-pacaya-v1.6.1-proposer-wrapper
    container_name: proposer-wrapper-deployer
    pull_policy: always
    volumes:
      - ./deployer:/deployer
      - ./deployment:/deployment
    entrypoint:
      - /bin/sh
      - -c
      - /deployer/deploy-proposer-wrapper.sh
    env_file:
      - .env
    environment:
      BROADCAST: ${BROADCAST:-false}
      GAS_LIMIT: ${GAS_LIMIT:-100000}
      TAIKO_WRAPPER: ${TAIKO_WRAPPER:-0x41596Ca8897dB0c236BA4FC693aB44B60ACebd6f}
      TAIKO_INBOX: ${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
      ADMIN: ${DEPLOYER_ADMIN:-0x3e95dFbBaF6B348396E6674C7871546dCC568e56}
      FOUNDRY_PROFILE: layer1
    networks:
      - surge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - wrapper-deployer

  surge-sgx-register:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-protocol:main-pacaya-v1.6.1-proposer-wrapper
    container_name: surge-sgx-register
    pull_policy: always
    volumes:
      - ./deployer:/deployer
    entrypoint:
      - /bin/sh
      - -c
      - /deployer/register-sgx.sh
    env_file:
      - .env
    environment:
      L1_ENDPOINT_HTTP: ${L1_ENDPOINT_HTTP:-http://host.docker.internal:32003}
      MR_ENCLAVE: ${MR_ENCLAVE:-3ec57ed7974834005b8df5d80e0edfc69542580a0a305f80fd81199c181ac7cc}
      MR_SIGNER: ${MR_SIGNER:-ca0583a715534a8c981b914589a7f0dc5d60959d9ae79fb5353299a4231673d5}
      V3_QUOTE_BYTES: ${V3_QUOTE_BYTES:-0x0000000000000000000000000000000000000000}
      AUTOMATA_DCAP_ATTESTATION: ${AUTOMATA_DCAP_ATTESTATION:-0x0000000000000000000000000000000000000000}
      SGX_RETH_VERIFIER: ${SGX_RETH_VERIFIER:-0x0000000000000000000000000000000000000000}
      PEM_CERT_CHAIN_LIB: ${PEM_CERT_CHAIN_LIB:-0x0000000000000000000000000000000000000000}
      BROADCAST: ${BROADCAST:-false}
      FOUNDRY_PROFILE: layer1
    networks:
      - surge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - sgx-register

  surge-risc0-register:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-protocol:main-pacaya-v1.6.1-proposer-wrapper
    container_name: surge-risc0-register
    pull_policy: always
    volumes:
      - ./deployer:/deployer
    entrypoint:
      - /bin/sh
      - -c
      - /deployer/register-risc0.sh
    env_file:
      - .env
    environment:
      GAS_LIMIT: ${GAS_LIMIT:-100000}
      RISC0_GROTH16_VERIFIER: ${RISC0_GROTH16_VERIFIER:-0x0000000000000000000000000000000000000000}
      RISC0_AGGREGATION_IMAGE_ID: ${RISC0_AGGREGATION_IMAGE_ID:-0x00dfdb4cc33bb068dce12585b8ecfcc8c3ae194ffaf6d19e0ebfd3fc33145c7a}
      RISC0_BLOCK_PROVING_IMAGE_ID: ${RISC0_BLOCK_PROVING_IMAGE_ID:-0x002eb51e99132ea02f27349345fe7e98c6867beab29a2426d1e4f693e2857bcd}
    networks:
      - surge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - risc0-register

  surge-sp1-register:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-protocol:main-pacaya-v1.6.1-proposer-wrapper
    container_name: surge-sp1-register
    pull_policy: always
    volumes:
      - ./deployer:/deployer
    entrypoint:
      - /bin/sh
      - -c
      - /deployer/register-sp1.sh
    env_file:
      - .env
    environment:
      GAS_LIMIT: ${GAS_LIMIT:-100000}
      SUCCINCT_VERIFIER: ${SUCCINCT_VERIFIER:-0x0000000000000000000000000000000000000000}
      SP1_BLOCK_PROVING_PROGRAM_VKEY: ${SP1_BLOCK_PROVING_PROGRAM_VKEY:-7551aa7009644e503ffa7fce53f657264a3a1b45516afc5b026ff7e43c10d62a}
      SP1_AGGREGATION_PROGRAM_VKEY: ${SP1_AGGREGATION_PROGRAM_VKEY:-0x000795db478eeeb7bef37247eb93389ba2a4e6c1cbe59a49afc3bd6ac2ad27ba}
    networks:
      - surge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - sp1-register

  surge-bond-depositer:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-protocol:main-pacaya-v1.6.1-proposer-wrapper
    container_name: surge-bond-depositer
    pull_policy: always
    volumes:
      - ./deployer:/deployer
    entrypoint:
      - /bin/sh
      - -c
      - /deployer/deposit-bond.sh
    env_file:
      - .env
    environment:
      TAIKO_INBOX: ${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
      SURGE_PROPOSER_WRAPPER: ${SURGE_PROPOSER_WRAPPER:-0x3Dd4d84519BD33AFFE89dDb2A8E52B33dFf8cDc5}
      BOND_AMOUNT: ${BROADCAST:-1000000000000000000}
      GAS_LIMIT: ${GAS_LIMIT:-100000}
    networks:
      - surge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - bond-depositer

  surge-l2-deployer:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-protocol:main-pacaya-v1.6.1-proposer-wrapper
    container_name: surge-l2-deployer
    pull_policy: always
    volumes:
      - ./deployer:/deployer
      - ./deployment:/deployment
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
      taiko_client_proposer:
        condition: service_started
    entrypoint:
      - /bin/sh
      - -c
      - /deployer/setup-surge-l2.sh
    env_file:
      - .env
    environment:
      L1_BRIDGE: ${L1_BRIDGE:-0x5aA2d74b6c6Ac10B31CAD704658057E5F1f9776e}
      L1_SIGNAL_SERVICE: ${L1_SIGNAL_SERVICE:-0x79567274013bc49010b63539645691D90B532a7e}
      L1_ERC1155_VAULT: ${L1_ERC1155_VAULT:-0x29C398777212635e44829457882c51ad04ad7355}
      L1_ERC20_VAULT: ${L1_ERC20_VAULT:-0x15b88c33dA5cF68e455A4f39A5Fc6592bbd9FE09}
      L1_ERC721_VAULT: ${L1_ERC721_VAULT:-0x286473AECCD308A6d8C7E72C98C54d3450bfEC84}
      L1_OWNER: ${L1_OWNER:-0x3e95dFbBaF6B348396E6674C7871546dCC568e56}
      FORK_URL: http://l2-nethermind-execution-client:${L2_HTTP_PORT}
      BROADCAST: ${BROADCAST:-false}
      FOUNDRY_PROFILE: layer2
    networks:
      - surge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    healthcheck:
      test: ["CMD-SHELL", "bash -c 'test -f /app/deployments/setup_l2.json'"]
      interval: 2s
      timeout: 2s
      retries: 15
      start_period: 10s
    profiles:
      - l2-deployer

# L2 stack components
  nethermind_execution_client:
    image: nethermindeth/nethermind:surge-nethermind
    container_name: l2-nethermind-execution-client
    restart: unless-stopped
    pull_policy: always
    stop_grace_period: 3m
    tty: true
    volumes:
      - ./execution-data:/data/surge
      - ./static/jwtsecret:/tmp/jwt/jwtsecret
      - ${CHAINSPEC_PATH_ON_HOST:-./static/hoodi/chainspec.json}:/chainspec.json
    networks:
      - surge
    ports:
      - ${L2_NETWORK_DISCOVERY_PORT}:${L2_NETWORK_DISCOVERY_PORT}/tcp
      - ${L2_NETWORK_DISCOVERY_PORT}:${L2_NETWORK_DISCOVERY_PORT}/udp
      - ${L2_METRICS_PORT}:${L2_METRICS_PORT}
      - ${L2_HTTP_PORT}:${L2_HTTP_PORT}
      - ${L2_WS_PORT}:${L2_WS_PORT}
      - ${L2_ENGINE_API_PORT}:${L2_ENGINE_API_PORT}
    environment:
      TAIKO_INBOX: ${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
    command:
      - --config=none
      - --datadir=/data/surge
      - --Init.ChainSpecPath=/chainspec.json
      - --Init.GenesisHash=${L2_GENESIS_HASH}
      - --Init.DiscoveryEnabled=false
      - --Metrics.Enabled=true
      - --Metrics.ExposePort=${L2_METRICS_PORT}
      - --JsonRpc.Enabled=true
      - --JsonRpc.EnabledModules=[debug,eth,net,web3,txpool,rpc,subscribe,trace,personal,proof,parity,health]
      - --JsonRpc.Host=0.0.0.0
      - --JsonRpc.Port=${L2_HTTP_PORT}
      - --JsonRpc.WebSocketsPort=${L2_WS_PORT}
      - --JsonRpc.JwtSecretFile=/tmp/jwt/jwtsecret
      - --JsonRpc.EngineHost=0.0.0.0
      - --JsonRpc.EnginePort=${L2_ENGINE_API_PORT}
      - --Network.DiscoveryPort=${L2_NETWORK_DISCOVERY_PORT}
      - --Network.P2PPort=${L2_NETWORK_DISCOVERY_PORT}
      - --Sync.FastSync=false
      - --Sync.SnapSync=false
      - --HealthChecks.Enabled=true
      - --Surge.L1EthApiEndpoint=${L1_ENDPOINT_HTTP}
      - --Surge.TaikoInboxAddress=${TAIKO_INBOX}
      - --log=${NETHERMIND_LOG_LEVEL}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "${L2_METRICS_PORT}"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    healthcheck:
      test: ["CMD-SHELL", "bash -c 'echo > /dev/tcp/localhost/8547'"]
      interval: 2s
      timeout: 2s
      retries: 15
      start_period: 10s
    profiles:
      - driver
      - proposer
      - prover
      - spammer
      - blockscout
      - l2-deployer
      - relayer-l1
      - relayer-l2
      - relayer-api

  taiko_client_driver:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-client:main-pacaya-v1.6.1-proposer-wrapper
    container_name: l2-taiko-consensus-client
    restart: unless-stopped
    pull_policy: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
        restart: true
    volumes:
      - ./execution-data:/data/surge
      - ./static/jwtsecret:/tmp/jwt/jwtsecret
      - ./script:/script
    ports:
      - 6060:6060
    env_file:
      - .env
    environment:
      TAIKO_INBOX: ${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    entrypoint:
      - /bin/sh
      - -c
      - "/script/start-driver.sh"
    networks:
      - surge
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6060"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - driver
      - proposer
      - prover
      - spammer
      - blockscout
      - l2-deployer
      - relayer-l1
      - relayer-l2
      - relayer-api

  taiko_client_proposer:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-client:main-pacaya-v1.6.1-proposer-wrapper
    container_name: l2-taiko-proposer-client
    restart: unless-stopped
    pull_policy: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
        restart: true
      taiko_client_driver:
        condition: service_started
    volumes:
      - ./execution-data:/data/taiko-nethermind
      - ./static/jwtsecret:/tmp/jwt/jwtsecret
      - ./script:/script
    ports:
      - 6061:6061
    env_file:
      - .env
    environment:
      TAIKO_INBOX: ${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
      L1_SIGNAL_SERVICE: ${L1_SIGNAL_SERVICE:-0x79567274013bc49010b63539645691D90B532a7e}
      L1_BRIDGE: ${L1_BRIDGE:-0x5aA2d74b6c6Ac10B31CAD704658057E5F1f9776e}
      TAIKO_WRAPPER: ${TAIKO_WRAPPER:-0x41596Ca8897dB0c236BA4FC693aB44B60ACebd6f}
      FORCED_INCLUSION_STORE: ${FORCED_INCLUSION_STORE:-0xbAE474CB9C962c6Df8E043C837CF02ad0B61199E}
      SURGE_PROPOSER_WRAPPER: ${SURGE_PROPOSER_WRAPPER:-0x3Dd4d84519BD33AFFE89dDb2A8E52B33dFf8cDc5}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    entrypoint:
      - /bin/sh
      - -c
      - "/script/start-proposer.sh"
    networks:
      - surge
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6061"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - proposer
      - spammer
      - l2-deployer

  taiko_client_prover_relayer:
    image: nethermind.jfrog.io/modular-oci-local-dev/taiko-client:main-pacaya-v1.6.1-proposer-wrapper
    container_name: l2-taiko-prover-relayer-client
    restart: unless-stopped
    pull_policy: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
        restart: true
      taiko_client_driver:
        condition: service_started
    volumes:
      - ./static/jwtsecret:/tmp/jwt/jwtsecret
      - ./script:/script
    ports:
      - 6062:6062
    env_file:
      - .env
    environment:
      TAIKO_INBOX: ${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
      SURGE_PROPOSER_WRAPPER: ${SURGE_PROPOSER_WRAPPER:-0x3Dd4d84519BD33AFFE89dDb2A8E52B33dFf8cDc5}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    entrypoint:
      - /bin/sh
      - -c
      - "/script/start-prover-relayer.sh"
    networks:
      - surge
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6062"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - prover

  tx-spammer:
    image: ethpandaops/spamoor:latest
    container_name: l2-tx-spammer
    restart: unless-stopped
    pull_policy: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
      taiko_client_proposer:
        condition: service_started
    volumes:
      - ./static/spamoor:/config
    ports:
      - 8080:8080
    entrypoint:
      - ./spamoor-daemon
    command:
      - "--rpchost=http://l2-nethermind-execution-client:${L2_HTTP_PORT}"
      - "--startup-spammer=/config/scenario-configs.yml"
      - "--privkey=0x94eb3102993b41ec55c241060f47daa0f6372e2e3ad7e91612ae36c364042e44"
    networks:
      - surge
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - spammer

  blockscout-postgres:
    image: postgres:alpine
    container_name: l2-blockscout-postgres
    restart: unless-stopped
    pull_policy: always
    volumes:
      - ./blockscout-postgres-data:/var/lib/postgresql/data
    ports:
      - ${POSTGRES_PORT}:${POSTGRES_PORT}
    environment:
      POSTGRES_DB: blockscout
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: MyPassword1!
      PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      GOSU_VERSION: 1.17
      PG_MAJOR: 17
      PG_VERSION: 17.5
      PG_SHA256: fcb7ab38e23b264d1902cb25e6adafb4525a6ebcbd015434aeef9eda80f528d8
      DOCKER_PG_LLVM_DEPS: llvm19-dev \t\tclang19
      PGDATA: /var/lib/postgresql/data
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command:
      - "-c"
      - "max_connections=1000"
    networks:
      - surge
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - blockscout

  blockscout-verifer:
    image: ghcr.io/blockscout/smart-contract-verifier:latest
    container_name: l2-blockscout-verif
    restart: unless-stopped
    pull_policy: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
      blockscout-postgres:
        condition: service_started
    ports:
      - ${VERIFIER_PORT}:${VERIFIER_PORT}
    environment:
      SMART_CONTRACT_VERIFIER__SERVER__HTTP__ADDR: 0.0.0.0:${VERIFIER_PORT}
      PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      APP_USER: app
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command:
      - "./smart-contract-verifier-server"
    networks:
      - surge
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - blockscout

  blockscout:
    image: ghcr.io/blockscout/blockscout:latest
    container_name: l2-blockscout
    restart: unless-stopped
    pull_policy: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
        restart: true
      taiko_client_driver:
        condition: service_started
      blockscout-postgres:
        condition: service_started
      blockscout-verifer:
        condition: service_started
    ports:
      - ${BLOCKSCOUT_PORT}:${BLOCKSCOUT_PORT}
    environment:
      MICROSERVICE_SC_VERIFIER_URL: http://l2-blockscout-verif:${VERIFIER_PORT}/api
      ECTO_USE_SSL: false
      ETHEREUM_JSONRPC_HTTP_URL: http://${BLOCKSCOUT_L2_HOST}:${L2_HTTP_PORT}/
      DATABASE_URL: postgresql://postgres:MyPassword1!@l2-blockscout-postgres:5432/blockscout
      ETHEREUM_JSONRPC_VARIANT: nethermind
      ETHEREUM_JSONRPC_TRACE_URL: http://${BLOCKSCOUT_L2_HOST}:${L2_HTTP_PORT}/
      SUBNETWORK: Surge
      API_V2_ENABLED: true
      PORT: ${BLOCKSCOUT_PORT}
      NETWORK: Surge
      MICROSERVICE_SC_VERIFIER_TYPE: sc_verifier
      INDEXER_DISABLE_PENDING_TRANSACTIONS_FETCHER: true
      COIN: ETH
      MICROSERVICE_SC_VERIFIER_ENABLED: true
      SECRET_KEY_BASE: 56NtB48ear7+wMSf0IQuWDAAazhpb31qyc7GiyspBP2vh7t5zlCsF5QDv76chXeN
      PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      DISABLE_WEBAPP: true
      ADMIN_PANEL_ENABLED: false
      DISABLE_API:
      API_V1_READ_METHODS_DISABLED:
      API_V1_WRITE_METHODS_DISABLED:
      CHAIN_TYPE:
      BRIDGED_TOKENS_ENABLED:
      API_GRAPHQL_MAX_COMPLEXITY:
      RELEASE_VERSION: 8.1.1
      BLOCKSCOUT_VERSION: v8.1.1
    command:
      - "/bin/sh"
      - "-c"
      - "bin/blockscout eval \"Elixir.Explorer.ReleaseTasks.create_and_migrate()\" && bin/blockscout start"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - surge
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - blockscout

  blockscout-frontend:
    image: ghcr.io/blockscout/frontend:latest
    container_name: l2-blockscout-frontend
    restart: unless-stopped
    pull_policy: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
      blockscout-postgres:
        condition: service_started
      blockscout-verifer:
        condition: service_started
      blockscout:
        condition: service_started
    ports:
      - ${BLOCKSCOUT_FRONTEND_PORT}:${BLOCKSCOUT_FRONTEND_PORT}
    environment:
      PORT: ${BLOCKSCOUT_FRONTEND_PORT}
      NEXT_PUBLIC_NETWORK_ICON: https://docs.surge.wtf/img/favicon.ico
      NEXT_PUBLIC_NETWORK_ID: ${L2_CHAINID}
      NEXT_PUBLIC_APP_PROTOCOL: http
      HOSTNAME: 0.0.0.0
      NEXT_PUBLIC_AD_BANNER_PROVIDER: none
      NEXT_PUBLIC_HAS_BEACON_CHAIN: false
      NEXT_PUBLIC_GAS_TRACKER_ENABLED: true
      # NEXT_PUBLIC_DISABLE_EXCHANGE_RATES: true
      NEXT_PUBLIC_NETWORK_NAME: Surge
      NEXT_PUBLIC_APP_HOST: 127.0.0.1
      NEXT_PUBLIC_API_PROTOCOL: http
      NEXT_PUBLIC_API_HOST: ${BLOCKSCOUT_API_HOST}:${BLOCKSCOUT_PORT}
      NEXT_PUBLIC_USE_NEXT_JS_PROXY: false
      NEXT_PUBLIC_NETWORK_RPC_URL: http://l2-nethermind-execution-client:${L2_HTTP_PORT}
      NEXT_PUBLIC_IS_TESTNET: true
      NEXT_PUBLIC_API_WEBSOCKET_PROTOCOL: ws
      NEXT_PUBLIC_APP_PORT: ${BLOCKSCOUT_FRONTEND_PORT}
      NEXT_PUBLIC_NETWORK_VERIFICATION_TYPE: validation
      NEXT_PUBLIC_AD_TEXT_PROVIDER: none
      PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      NODE_VERSION: 22.11.0
      YARN_VERSION: 1.22.22
      ENVS_PRESET:
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - surge
    labels:
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - blockscout

# Relayer infrastructure services
  relayer-db:
    image: mysql:8.0
    container_name: relayer-db
    cap_add:
      - SYS_NICE
    restart: always
    env_file:
      - .env
    environment:
      - MYSQL_DATABASE=${MYSQL_DATABASE}
      - MYSQL_ROOT_PASSWORD=${MYSQL_PASSWORD}
    ports:
      - "3306:3306"
    volumes:
      - ./mysql-data:/var/lib/mysql
    networks:
      - surge
    profiles:
      - relayer-init

  relayer-migrations:
    image: ghcr.io/kukymbr/goose-docker:latest
    container_name: relayer-migrations
    environment:
      - GOOSE_DRIVER=mysql
      - GOOSE_DBSTRING=${MYSQL_USER}:${MYSQL_PASSWORD}@tcp(relayer-db:3306)/${MYSQL_DATABASE}
    volumes:
      - ./migrations:/migrations
    networks:
      - surge
    profiles:
      - relayer-migrations

  relayer-rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: relayer-rabbitmq
    env_file:
      - .env
    environment:
      - RABBITMQ_DEFAULT_USER=${RABBITMQ_USER}
      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_PASSWORD}
    ports:
      - ${RABBITMQ_PORT}:${RABBITMQ_PORT}
      - 15672:15672
      - 15692:15692
    volumes:
      - ./rabbitmq/data/:/var/lib/rabbitmq/
      - ./rabbitmq/log/:/var/log/rabbitmq
    networks:
      - surge
    profiles:
      - relayer-init

  relayer-l1-processor:
    image: nethermind.jfrog.io/modular-oci-local-dev/relayer:sha-fbbab41
    container_name: relayer-l1-processor
    restart: always
    environment:
      - L1_SIGNAL_SERVICE=${L1_SIGNAL_SERVICE:-0x79567274013bc49010b63539645691D90B532a7e}
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
    entrypoint: ["/usr/local/bin/relayer"]
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - 6063:6063
    command:
      - processor
      - --queue.prefetch=${QUEUE_PREFETCH}
      - --db.host=relayer-db
      - --db.maxIdleConns=${MYSQL_MAX_IDLE_CONNS}
      - --db.maxOpenConns=${MYSQL_MAX_OPEN_CONNS}
      - --db.name=${MYSQL_DATABASE}
      - --db.password=${MYSQL_PASSWORD}
      - --db.username=${MYSQL_USER}
      - --queue.host=relayer-rabbitmq
      - --queue.password=${RABBITMQ_PASSWORD}
      - --queue.port=${RABBITMQ_PORT}
      - --queue.username=${RABBITMQ_USER}
      - --processorPrivateKey=${PROCESSOR_PRIVATE_KEY}
      - --srcSignalServiceAddress=${L1_SIGNAL_SERVICE}
      - --srcRpcUrl=http://host.docker.internal:32003
      - --destBridgeAddress=${L2_BRIDGE}
      - --destERC20VaultAddress=${L2_ERC20_VAULT}
      - --destERC721Address=${L2_ERC721_VAULT}
      - --destERC1155Address=${L2_ERC1155_VAULT}
      - --destTaikoAddress=${TAIKO_ANCHOR}
      - --destRpcUrl=http://nethermind_execution_client:${L2_HTTP_PORT}
      - --confirmations=${CONFIRMATIONS_BEFORE_PROCESSING:-0}
      - --headerSyncInterval=${HEADER_SYNC_INTERVAL_IN_SECONDS:-2}
      - --profitableOnly=${PROFITABLE_ONLY:-false}
      - --tx.minTipCap=${TX_MIN_TIP_CAP:-0.01}
      - --metrics.port=6063
    networks:
      - surge
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6063"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - relayer-l1

  relayer-l1-indexer:
    image: nethermind.jfrog.io/modular-oci-local-dev/relayer:sha-fbbab41
    container_name: relayer-l1-indexer
    restart: always
    env_file:
      - .env
    environment:
      - TAIKO_INBOX=${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
      - L1_SIGNAL_SERVICE=${L1_SIGNAL_SERVICE:-0x79567274013bc49010b63539645691D90B532a7e}
      - L1_BRIDGE=${L1_BRIDGE:-0x5aA2d74b6c6Ac10B31CAD704658057E5F1f9776e}
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
    entrypoint: ["/usr/local/bin/relayer"]
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - 6064:6064
    command:
      - indexer
      - --db.host=relayer-db
      - --db.connMaxLifetime=${MYSQL_CONN_MAX_LIFETIME}
      - --db.maxIdleConns=${MYSQL_MAX_IDLE_CONNS}
      - --db.maxOpenConns=${MYSQL_MAX_OPEN_CONNS}
      - --db.name=${MYSQL_DATABASE}
      - --db.password=${MYSQL_PASSWORD}
      - --db.username=${MYSQL_USER}
      - --queue.host=relayer-rabbitmq
      - --queue.password=${RABBITMQ_PASSWORD}
      - --queue.port=${RABBITMQ_PORT}
      - --queue.username=${RABBITMQ_USER}
      - --srcBridgeAddress=${L1_BRIDGE}
      - --srcTaikoAddress=${TAIKO_INBOX}
      - --srcSignalServiceAddress=${L1_SIGNAL_SERVICE}
      - --srcRpcUrl=http://host.docker.internal:32003
      - --destBridgeAddress=${L2_BRIDGE}
      - --destRpcUrl=http://nethermind_execution_client:${L2_HTTP_PORT}
      - --maxNumGoroutines=${NUM_GOROUTINES}
      - --blockBatchSize=${BLOCK_BATCH_SIZE}
      - --event=MessageSent
      - --confirmations=${CONFIRMATIONS_BEFORE_PROCESSING:-0}
      - --metrics.port=6064
    networks:
      - surge
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6064"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - relayer-l1

  relayer-l1-api:
    image: nethermind.jfrog.io/modular-oci-local-dev/relayer:sha-fbbab41
    container_name: relayer-l1-api
    restart: always
    env_file:
      - .env
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
    entrypoint: ["/usr/local/bin/relayer"]
    ports:
      - 4102:4102
      - 6065:6065
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command:
      - api
      - --db.host=relayer-db
      - --db.connMaxLifetime=${MYSQL_CONN_MAX_LIFETIME}
      - --db.maxIdleConns=${MYSQL_MAX_IDLE_CONNS}
      - --db.maxOpenConns=${MYSQL_MAX_OPEN_CONNS}
      - --db.name=${MYSQL_DATABASE}
      - --db.password=${MYSQL_PASSWORD}
      - --db.username=${MYSQL_USER}
      - --srcRpcUrl=http://host.docker.internal:32003
      - --destRpcUrl=http://nethermind_execution_client:${L2_HTTP_PORT}
      - --destTaikoAddress=${TAIKO_ANCHOR}
      - --processingFeeMultiplier=${PROCESSING_FEE_MULTIPLIER}
      - --metrics.port=6065
    networks:
      - surge
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6065"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - relayer-api

  relayer-l2-api:
    image: nethermind.jfrog.io/modular-oci-local-dev/relayer:sha-fbbab41
    container_name: relayer-l2-api
    restart: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
    environment:
      - TAIKO_INBOX=${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
    entrypoint: ["/usr/local/bin/relayer"]
    ports:
      - 4103:4103
      - 6066:6066
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command:
      - api
      - --db.host=relayer-db
      - --db.connMaxLifetime=${MYSQL_CONN_MAX_LIFETIME}
      - --db.maxIdleConns=${MYSQL_MAX_IDLE_CONNS}
      - --db.maxOpenConns=${MYSQL_MAX_OPEN_CONNS}
      - --db.name=${MYSQL_DATABASE}
      - --db.password=${MYSQL_PASSWORD}
      - --db.username=${MYSQL_USER}
      - --srcRpcUrl=http://nethermind_execution_client:${L2_HTTP_PORT}
      - --destRpcUrl=http://host.docker.internal:32003
      - --destTaikoAddress=${TAIKO_INBOX}
      - --processingFeeMultiplier=${PROCESSING_FEE_MULTIPLIER}
      - --metrics.port=6066
    networks:
      - surge
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6066"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - relayer-api

  relayer-l2-processor:
    image: nethermind.jfrog.io/modular-oci-local-dev/relayer:sha-fbbab41
    container_name: relayer-l2-processor
    restart: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
    environment:
      - TAIKO_INBOX=${TAIKO_INBOX:-0x87913733CBcD740C19fB25c746A79AbcC255e325}
      - L1_BRIDGE=${L1_BRIDGE:-0x5aA2d74b6c6Ac10B31CAD704658057E5F1f9776e}
      - L1_ERC20_VAULT=${L1_ERC20_VAULT:-0x15b88c33dA5cF68e455A4f39A5Fc6592bbd9FE09}
      - L1_ERC721_VAULT=${L1_ERC721_VAULT:-0x286473AECCD308A6d8C7E72C98C54d3450bfEC84}
      - L1_ERC1155_VAULT=${L1_ERC1155_VAULT:-0x29C398777212635e44829457882c51ad04ad7355}
    entrypoint: ["/usr/local/bin/relayer"]
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - 6067:6067
    command:
      - processor
      - --queue.prefetch=100
      - --db.host=relayer-db
      - --db.maxIdleConns=${MYSQL_MAX_IDLE_CONNS}
      - --db.maxOpenConns=${MYSQL_MAX_OPEN_CONNS}
      - --db.name=${MYSQL_DATABASE}
      - --db.password=${MYSQL_PASSWORD}
      - --db.username=${MYSQL_USER}
      - --queue.host=relayer-rabbitmq
      - --queue.password=${RABBITMQ_PASSWORD}
      - --queue.port=${RABBITMQ_PORT}
      - --queue.username=${RABBITMQ_USER}
      - --processorPrivateKey=${PROCESSOR_PRIVATE_KEY}
      - --srcSignalServiceAddress=${L2_SIGNAL_SERVICE}
      - --srcRpcUrl=http://nethermind_execution_client:${L2_HTTP_PORT}
      - --destBridgeAddress=${L1_BRIDGE}
      - --destERC20VaultAddress=${L1_ERC20_VAULT}
      - --destERC721Address=${L1_ERC721_VAULT}
      - --destERC1155Address=${L1_ERC1155_VAULT}
      - --destTaikoAddress=${TAIKO_INBOX}
      - --destRpcUrl=http://host.docker.internal:32003
      - --confirmations=${CONFIRMATIONS_BEFORE_PROCESSING:-0}
      - --headerSyncInterval=${HEADER_SYNC_INTERVAL_IN_SECONDS:-2}
      - --profitableOnly=${PROFITABLE_ONLY:-false}
      - --tx.minTipCap=${TX_MIN_TIP_CAP:-0.01}
      - --metrics.port=6067
    networks:
      - surge
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6067"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - relayer-l2

  relayer-l2-indexer:
    image: nethermind.jfrog.io/modular-oci-local-dev/relayer:sha-fbbab41
    container_name: relayer-l2-indexer
    restart: always
    depends_on:
      nethermind_execution_client:
        condition: service_healthy
      taiko_client_driver:
        condition: service_started
    environment:
      - L1_BRIDGE=${L1_BRIDGE:-0x5aA2d74b6c6Ac10B31CAD704658057E5F1f9776e}
    entrypoint: ["/usr/local/bin/relayer"]
    ports:
      - 6068:6068
    command:
      - indexer
      - --db.host=relayer-db
      - --db.connMaxLifetime=${MYSQL_CONN_MAX_LIFETIME}
      - --db.maxIdleConns=${MYSQL_MAX_IDLE_CONNS}
      - --db.maxOpenConns=${MYSQL_MAX_OPEN_CONNS}
      - --db.name=${MYSQL_DATABASE}
      - --db.password=${MYSQL_PASSWORD}
      - --db.username=${MYSQL_USER}
      - --queue.host=relayer-rabbitmq
      - --queue.password=${RABBITMQ_PASSWORD}
      - --queue.port=${RABBITMQ_PORT}
      - --queue.username=${RABBITMQ_USER}
      - --srcBridgeAddress=${L2_BRIDGE}
      - --srcSignalServiceAddress=${L2_SIGNAL_SERVICE}
      - --srcRpcUrl=http://nethermind_execution_client:${L2_HTTP_PORT}
      - --destBridgeAddress=${L1_BRIDGE}
      - --destRpcUrl=http://host.docker.internal:32003
      - --maxNumGoroutines=${NUM_GOROUTINES}
      - --blockBatchSize=${BLOCK_BATCH_SIZE}
      - --event=MessageSent
      - --confirmations=${CONFIRMATIONS_BEFORE_PROCESSING:-0}
      - --metrics.port=6068
    networks:
      - surge
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      com.kurtosistech.custom.metrics_enabled: "true"
      com.kurtosistech.custom.metrics_port: "6068"
      com.kurtosistech.custom.logs_enabled: "true"
      com.kurtosistech.custom.custom_network: "devnet"
    profiles:
      - relayer-l2

networks:
  surge:
    name: surge-network
